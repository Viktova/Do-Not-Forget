function $(e){return document.getElementById(e)}function remove_facebook_token_in_url(){window.location.hash&&"#_=_"===window.location.hash&&(window.history&&history.pushState?window.history.pushState("",document.title,window.location.pathname):window.location.hash="")}function initXMLhttp(){var e;return e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}function minAjax(e){var t=window.console;if(!e.url)return void(1===e.debugLog&&t.log("No Url!"));if(!e.type)return void(1===e.debugLog&&t.log("No Default type (GET/POST) given!"));e.method||(e.method=!0),e.debugLog||(e.debugLog=!1);var o=initXMLhttp();o.onreadystatechange=function(){4===o.readyState&&200===o.status?(e.success&&e.success(o.responseText,o.readyState),1===e.debugLog&&t.log("SuccessResponse"),1===e.debugLog&&t.log("Response Data:"+o.responseText)):1===e.debugLog&&t.log("FailureResponse --> State:"+o.readyState+"Status:"+o.status)};var a=[],n=e.data;if("string"==typeof n)for(var r=String.prototype.split.call(n,"&"),i=0,l=r.length;l>i;i++){var d=r[i].split("=");a.push(encodeURIComponent(d[0])+"="+encodeURIComponent(d[1]))}else if("object"==typeof n&&!(n instanceof String||FormData&&n instanceof FormData))for(var s in n){var d=n[s];if("[object Array]"===Object.prototype.toString.call(d))for(var i=0,l=d.length;l>i;i++)a.push(encodeURIComponent(s)+"[]="+encodeURIComponent(d[i]));else a.push(encodeURIComponent(s)+"="+encodeURIComponent(d))}a=a.join("&"),"GET"===e.type&&(o.open("GET",e.url+"?"+a,e.method),o.send(),1===e.debugLog&&t.log("GET fired at:"+e.url+"?"+a)),"POST"===e.type&&(o.open("POST",e.url,e.method),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(a),1===e.debugLog&&t.log("POST fired at:"+e.url+" || Data:"+a))}function decodeHtml(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function appendLI(e){return"<li>"!==e.substring(0,4)&&(e="<li>"+e),e}function update_remote_from_local(){remoteLastModified=new Date(localStorage.remoteLastModified),localLastModified=new Date(localStorage.localLastModified),sync_mode&&hasChanged&&localLastModified.getTime()>remoteLastModified.getTime()&&(syncStatusMarker.innerHTML="Syncing...",minAjax({url:"/update-memo",type:"POST",data:{id:user.id,email:user.email,memo:appendLI(localStorage.getItem(localstorage_var_name))},success:function(e){localStorage.setItem("remoteLastModified",e),remoteLastModifiedMarker.innerHTML=e,user.remoteLastModified=e,hasChanged=!1,syncStatusMarker.innerHTML="Saved online."}}))}var syncStatusMarker,remoteLastModified,remoteLastModifiedMarker,localLastModified,localLastModifiedMarker,editable,user,sync_mode,timerInt,refresh_rate=5e3,localstorage_var_name="memotab",debug=!1,hasChanged=!1,editable=$("editable"),localLastModifiedMarker=$("localLastModified");window.console=window.console||function(){var e={};return e.log=e.warn=e.debug=e.info=e.error=e.time=e.dir=e.profile=e.clear=e.exception=e.trace=e.assert=function(e){},e}();var addEvent=function(){return document.addEventListener?function(e,t,o){if(e.length)for(var a=0;a<e.length;a++)addEvent(e[a],t,o);else e.addEventListener(t,o,!1)}:function(e,t,o){if(e.length)for(var a=0;a<e.length;a++)addEvent(e[a],t,o);else e.attachEvent("on"+t,function(){return o.call(e,window.event)})}}();sync_mode=window.synchronization||!1,remove_facebook_token_in_url(),editable=$("editable"),localLastModifiedMarker=$("localLastModified"),sync_mode&&(user={},localstorage_var_name="memotab",user.id=$("user_id").value,user.email=$("user_email").value,user.memo=decodeHtml($("user_memo").value),user.remoteLastModified=$("user_last_modified").value,localStorage.setItem("remoteLastModified",user.remoteLastModified),remoteLastModified=new Date(localStorage.remoteLastModified),localLastModified=new Date(localStorage.localLastModified),localStorage.setItem(localstorage_var_name,user.memo),remoteLastModified.getTime()>localLastModified.getTime()&&localStorage.setItem(localstorage_var_name,user.memo),remoteLastModifiedMarker=$("remoteLastModified"),syncStatusMarker=$("sync-status-marker")),debug&&($("debugger").style.display="block"),addEvent(editable,"keyup",function(e){""===this.innerHTML&&(this.innerHTML="<li>"),localStorage.setItem(localstorage_var_name,this.innerHTML);var t=new Date;localStorage.setItem("localLastModified",t.toDateString()+" "+t.toLocaleTimeString()),hasChanged=!0,sync_mode&&(syncStatusMarker.innerHTML="Saved locally.",user.update_local_from_remote(20))}),addEvent($("clear"),"click",function(){localStorage.setItem(localstorage_var_name,""),editable.innerHTML="<li>",editable.focus()}),localStorage.getItem(localstorage_var_name)&&(editable.innerHTML=localStorage.getItem(localstorage_var_name)),localLastModifiedMarker&&localStorage.getItem("localLastModified")&&(localLastModifiedMarker.innerHTML=localStorage.getItem("localLastModified")),sync_mode&&(addEvent(document,"mousemove",function(){user.update_local_from_remote(20)}),setInterval(update_remote_from_local,refresh_rate),addEvent(window,"beforeunload",function(){update_remote_from_local()}),user.update_local_from_remote=function(e){var t=document.querySelector("#sync-status-marker");clearInterval(timerInt);var o=e,a,n;timerInt=setInterval(function(){a=parseInt(o/60,10),n=parseInt(o%60,10),a=10>a?"0"+a:a,n=10>n?"0"+n:n,t.textContent="",e-5>o&&(t.textContent=""),e-15>o&&(t.textContent="Syncing in "+a+":"+n),--o<0&&(o=e,minAjax({url:"/fetch-memo",type:"POST",data:{id:user.id,email:user.email},success:function(e){localStorage.setItem(localstorage_var_name,e),$("editable").innerHTML=e,t.textContent="All synced."}}))},1e3)},user.update_local_from_remote(20));
//# sourceMappingURL=./dnfm-min.js.map