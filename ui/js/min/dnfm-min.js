function $(e){return document.getElementById(e)}function remove_facebook_token_in_url(){window.location.hash&&"#_=_"===window.location.hash&&(window.history&&history.pushState?window.history.pushState("",document.title,window.location.pathname):window.location.hash="")}function initXMLhttp(){var e;return e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}function minAjax(e){var t=window.console;if(!e.url)return void(1===e.debugLog&&t.log("No Url!"));if(!e.type)return void(1===e.debugLog&&t.log("No Default type (GET/POST) given!"));e.method||(e.method=!0),e.debugLog||(e.debugLog=!1);var n=initXMLhttp();n.onreadystatechange=function(){4===n.readyState&&200===n.status?(e.success&&e.success(n.responseText,n.readyState),1===e.debugLog&&t.log("SuccessResponse"),1===e.debugLog&&t.log("Response Data:"+n.responseText)):1===e.debugLog&&t.log("FailureResponse --> State:"+n.readyState+"Status:"+n.status)};var o=[],i=e.data;if("string"==typeof i)for(var r=String.prototype.split.call(i,"&"),a=0,s=r.length;s>a;a++){var l=r[a].split("=");o.push(encodeURIComponent(l[0])+"="+encodeURIComponent(l[1]))}else if("object"==typeof i&&!(i instanceof String||FormData&&i instanceof FormData))for(var c in i){var l=i[c];if("[object Array]"===Object.prototype.toString.call(l))for(var a=0,s=l.length;s>a;a++)o.push(encodeURIComponent(c)+"[]="+encodeURIComponent(l[a]));else o.push(encodeURIComponent(c)+"="+encodeURIComponent(l))}o=o.join("&"),"GET"===e.type&&(n.open("GET",e.url+"?"+o,e.method),n.send(),1===e.debugLog&&t.log("GET fired at:"+e.url+"?"+o)),"POST"===e.type&&(n.open("POST",e.url,e.method),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(o),1===e.debugLog&&t.log("POST fired at:"+e.url+" || Data:"+o))}function decodeHtml(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function appendLI(e){return"<li>"!==e.substring(0,4)&&(e="<li>"+e),e}function reset(){localStorage[localstorage_var_name]=medium.value("hello")}var syncStatusMarker,remoteLastModified,remoteLastModifiedMarker,localLastModified,localLastModifiedMarker,editable,user,sync_mode,timerInt,refresh_rate=5e3,localstorage_var_name="memotab",debug=!1,hasChanged=!1,editable=$("editable"),localLastModifiedMarker=$("localLastModified"),localKeyUpTimer;window.console=window.console||function(){var e={};return e.log=e.warn=e.debug=e.info=e.error=e.time=e.dir=e.profile=e.clear=e.exception=e.trace=e.assert=function(e){},e}();var addEvent=function(){return document.addEventListener?function(e,t,n){if(e.length)for(var o=0;o<e.length;o++)addEvent(e[o],t,n);else e.addEventListener(t,n,!1)}:function(e,t,n){if(e.length)for(var o=0;o<e.length;o++)addEvent(e[o],t,n);else e.attachEvent("on"+t,function(){return n.call(e,window.event)})}}();(function(){function e(e,t){var n,o;for(n in t)o=t[n],void 0!==o&&(e[n]=o);return e}var t=function(){},n=function(n,o){var i;return i=o&&o.hasOwnProperty("constructor")?o.constructor:function(){return n.apply(this,arguments)},t.prototype=n.prototype,i.prototype=new t,o&&e(i.prototype,o),i.prototype.constructor=i,i.__super__=n.prototype,i},o;o="undefined"!=typeof exports?exports:this.Undo={},o.Stack=function(){this.commands=[],this.stackPosition=-1,this.savePosition=-1},e(o.Stack.prototype,{execute:function(e){this._clearRedo(),e.execute(),this.commands.push(e),this.stackPosition++,this.changed()},undo:function(){this.commands[this.stackPosition].undo(),this.stackPosition--,this.changed()},canUndo:function(){return this.stackPosition>=0},redo:function(){this.stackPosition++,this.commands[this.stackPosition].redo(),this.changed()},canRedo:function(){return this.stackPosition<this.commands.length-1},save:function(){this.savePosition=this.stackPosition,this.changed()},dirty:function(){return this.stackPosition!=this.savePosition},_clearRedo:function(){this.commands=this.commands.slice(0,this.stackPosition+1)},changed:function(){}}),o.Command=function(e){this.name=e};var i=new Error("override me!");e(o.Command.prototype,{execute:function(){throw i},undo:function(){throw i},redo:function(){this.execute()}}),o.Command.extend=function(e){var t=n(this,e);return t.extend=o.Command.extend,t}}).call(this),function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n==C||!(n!=v||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=v||!e[t])}function n(e,t){return typeof e[t]!=y}function o(e){return function(t,n){for(var o=n.length;o--;)if(!e(t,n[o]))return!1;return!0}}function i(e){return e&&T(e,S)&&b(e,N)}function r(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(t){typeof console!=y&&e(console,"log")&&console.log(t)}function s(e,t){A&&t?alert(e):a(e)}function l(e){O.initialized=!0,O.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,O.config.alertOnFail)}function c(e){s("Rangy warning: "+e,O.config.alertOnWarn)}function d(e){return e.message||e.description||String(e)}function u(){if(A&&!O.initialized){var t,n=!1,o=!1;e(document,"createRange")&&(t=document.createRange(),T(t,R)&&b(t,E)&&(n=!0));var s=r(document);if(!s||"body"!=s.nodeName.toLowerCase())return void l("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),i(t)&&(o=!0)),!n&&!o)return void l("Neither Range nor TextRange are available");O.initialized=!0,O.features={implementsDomRange:n,implementsTextRange:o};var c,u;for(var f in x)(c=x[f])instanceof h&&c.init(c,O);for(var g=0,m=k.length;m>g;++g)try{k[g](O)}catch(p){u="Rangy init listener threw an exception. Continuing. Detail: "+d(p),a(u)}}}function f(e){e=e||window,u();for(var t=0,n=D.length;n>t;++t)D[t](e)}function h(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function g(e,t,n){var o=new h(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(O,t),t.supported=!0}catch(o){var i="Module '"+e+"' failed to load: "+d(o);a(i),o.stack&&a(o.stack)}}});return x[e]=o,o}function m(){}function p(){}var v="object",C="function",y="undefined",E=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],R=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],N=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],S=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],T=o(e),w=o(t),b=o(n),x={},A=typeof window!=y&&typeof document!=y,_={isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:T,areHostObjects:w,areHostProperties:b,isTextRange:i,getBody:r},O={version:"1.3.0-alpha.20150122",initialized:!1,isBrowser:A,supported:!0,util:_,features:{},modules:x,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==y?!0:rangyAutoInitialize}};O.fail=l,O.warn=c;var M;({}).hasOwnProperty?(_.extend=M=function(e,t,n){var o,i;for(var r in t)t.hasOwnProperty(r)&&(o=e[r],i=t[r],n&&null!==o&&"object"==typeof o&&null!==i&&"object"==typeof i&&M(o,i,!0),e[r]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},_.createOptions=function(e,t){var n={};return M(n,t),e&&M(n,e),n}):l("hasOwnProperty not supported"),A||l("Rangy can only run in a browser"),function(){var e;if(A){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(o){}}e||(e=function(e){for(var t=[],n=0,o=e.length;o>n;++n)t[n]=e[n];return t}),_.toArray=e}();var L;A&&(e(document,"addEventListener")?L=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?L=function(e,t,n){e.attachEvent("on"+t,n)}:l("Document does not have required addEventListener or attachEvent method"),_.addListener=L);var k=[];O.init=u,O.addInitListener=function(e){O.initialized?e(O):k.push(e)};var D=[];O.addShimListener=function(e){D.push(e)},A&&(O.shim=O.createMissingNativeApi=f),h.prototype={init:function(){for(var e=this.dependencies||[],t=0,n=e.length,o,i;n>t;++t){if(i=e[t],o=x[i],!(o&&o instanceof h))throw new Error("required module '"+i+"' not found");if(o.init(),!o.supported)throw new Error("required module '"+i+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){O.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){O.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},O.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var o=g(e,n,t);O.initialized&&O.supported&&o.init()},O.createCoreModule=function(e,t,n){g(e,t,n)},O.RangePrototype=m,O.rangePrototype=new m,O.selectionPrototype=new p,O.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==_||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function o(e){var t=e.parentNode;return 1==t.nodeType?t:null}function i(e){for(var t=0;e=e.previousSibling;)++t;return t}function r(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n=[],o;for(o=e;o;o=o.parentNode)n.push(o);for(o=t;o;o=o.parentNode)if(k(n,o))return o;return null}function s(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function l(e,t){return s(e,t,!0)}function c(e,t,n){for(var o,i=n?e:e.parentNode;i;){if(o=i.parentNode,o===t)return i;i=o}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function f(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function h(e,t,n){var o=e.cloneNode(!1);if(o.deleteData(0,t),e.deleteData(t,e.length-t),f(o,e),n)for(var r=0,a;a=n[r++];)a.node==e&&a.offset>t?(a.node=o,a.offset-=t):a.node==e.parentNode&&a.offset>i(e)&&++a.offset;return o}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=_)return e.ownerDocument;if(typeof e.document!=_)return e.document;if(e.parentNode)return g(e.parentNode);throw t.createError("getDocument: no document found for node")}function m(e){var n=g(e);if(typeof n.defaultView!=_)return n.defaultView;if(typeof n.parentWindow!=_)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function p(e){if(typeof e.contentDocument!=_)return e.contentDocument;if(typeof e.contentWindow!=_)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=_)return e.contentWindow;if(typeof e.contentDocument!=_)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function C(e){return e&&O.isHostMethod(e,"setTimeout")&&O.isHostObject(e,"document")}function y(e,t,n){var o;if(e?O.isHostProperty(e,"nodeType")?o=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?p(e):g(e):C(e)&&(o=e.document):o=document,!o)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return o}function E(e){for(var t;t=e.parentNode;)e=t;return e}function R(e,n,o,r){var s,l,d,u,f;if(e==o)return n===r?0:r>n?-1:1;if(s=c(o,e,!0))return n<=i(s)?-1:1;if(s=c(e,o,!0))return i(s)<r?-1:1;if(l=a(e,o),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(d=e===l?l:c(e,l,!0),u=o===l?l:c(o,l,!0),d===u)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(f=l.firstChild;f;){if(f===d)return-1;if(f===u)return 1;f=f.nextSibling}}function N(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function S(e){if(!e)return"[No node]";if(D&&N(e))return"[Broken node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+i(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function T(e){for(var t=g(e).createDocumentFragment(),n;n=e.firstChild;)t.appendChild(n);return t}function w(e){this.root=e,this._next=e}function b(e){return new w(e)}function x(e,t){this.node=e,this.offset=t}function A(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var _="undefined",O=e.util;O.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),O.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var M=document.createElement("div");O.areHostMethods(M,["insertBefore","appendChild","cloneNode"]||!O.areHostObjects(M,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),O.isHostProperty(M,"innerHTML")||t.fail("Element is missing innerHTML property");var L=document.createTextNode("test");O.areHostMethods(L,["splitText","deleteData","insertData","appendData","cloneNode"]||!O.areHostObjects(M,["previousSibling","nextSibling","childNodes","parentNode"])||!O.areHostProperties(L,["data"]))||t.fail("Incomplete Text Node implementation");var k=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},D=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",D=N(n),e.features.crashyTextNodes=D}();var P;typeof window.getComputedStyle!=_?P=function(e,t){return m(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=_?P=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current)if(t=e.firstChild)this._next=t;else{for(n=null;e!==this.root&&!(n=e.nextSibling);)e=e.parentNode;this._next=n}return this._current},detach:function(){this._current=this._next=this.root=null}},x.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+S(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},A.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},A.prototype.toString=function(){return this.message},e.dom={arrayContains:k,isHtmlNamespace:n,parentElement:o,getNodeIndex:i,getNodeLength:r,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:c,isCharacterDataNode:d,isTextOrCommentNode:u,insertAfter:f,splitDataNode:h,getDocument:g,getWindow:m,getIframeWindow:v,getIframeDocument:p,getBody:O.getBody,isWindow:C,getContentDocument:y,getRootContainer:E,comparePoints:R,isBrokenNode:N,inspectNode:S,getComputedStyleProperty:P,fragmentFromNodeChildren:T,createIterator:b,DomPosition:x},e.DOMException=A}),O.createCoreModule("DomRange",["DomUtil"],function(e,t){function n(e,t){return 3!=e.nodeType&&(z(e,t.startContainer)||z(e,t.endContainer))}function o(e){return e.document||j(e.startContainer)}function i(e){return new I(e.parentNode,W(e))}function r(e){return new I(e.parentNode,W(e)+1)}function a(e,t,n){var o=11==e.nodeType?e.firstChild:e;return U(t)?n==t.length?P.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:V(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function s(e,t,n){if(w(e),w(t),o(t)!=o(e))throw new B("WRONG_DOCUMENT_ERR");var i=F(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=F(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?0>=i&&r>=0:0>i&&r>0}function l(e){for(var t,n,i=o(e.range).createDocumentFragment(),r;n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(r=e.getSubtreeIterator(),n.appendChild(l(r)),r.detach()),10==n.nodeType)throw new B("HIERARCHY_REQUEST_ERR");i.appendChild(n)}return i}function c(e,t,n){var o,i;n=n||{stop:!1};for(var r,a;r=e.next();)if(e.isPartiallySelectedSubtree()){if(t(r)===!1)return void(n.stop=!0);if(a=e.getSubtreeIterator(),c(a,t,n),a.detach(),n.stop)return}else for(o=P.createIterator(r);i=o.next();)if(t(i)===!1)return void(n.stop=!0)}function d(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),d(t),t.detach()):e.remove()}function u(e){for(var t,n=o(e.range).createDocumentFragment(),i;t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=e.getSubtreeIterator(),t.appendChild(u(i)),i.detach()):e.remove(),10==t.nodeType)throw new B("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function f(e,t,n){var o=!(!t||!t.length),i,r=!!n;o&&(i=new RegExp("^("+t.join("|")+")$"));var a=[];return c(new g(e,!1),function(t){if((!o||i.test(t.nodeType))&&(!r||n(t))){var s=e.startContainer;if(t!=s||!U(s)||e.startOffset!=s.length){var l=e.endContainer;t==l&&U(l)&&0==e.endOffset||a.push(t)}}}),a}function h(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+P.inspectNode(e.startContainer)+":"+e.startOffset+", "+P.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function g(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&U(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||U(this.sc)?K(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||U(this.ec)?K(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(e){return function(t,n){for(var o,i=n?t:t.parentNode;i;){if(o=i.nodeType,G(e,o))return i;i=i.parentNode}return null}}function p(e,t){if(ie(e,t))throw new B("INVALID_NODE_TYPE_ERR")}function v(e,t){if(!G(t,e.nodeType))throw new B("INVALID_NODE_TYPE_ERR")}function C(e,t){if(0>t||t>(U(e)?e.length:e.childNodes.length))throw new B("INDEX_SIZE_ERR")}function y(e,t){if(ne(e,!0)!==ne(t,!0))throw new B("WRONG_DOCUMENT_ERR")}function E(e){if(oe(e,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR")}function R(e,t){if(!e)throw new B(t)}function N(e){return Y&&P.isBrokenNode(e)||!G(Z,e.nodeType)&&!ne(e,!0)}function S(e,t){return t<=(U(e)?e.length:e.childNodes.length)}function T(e){return!!e.startContainer&&!!e.endContainer&&!N(e.startContainer)&&!N(e.endContainer)&&S(e.startContainer,e.startOffset)&&S(e.endContainer,e.endOffset)}function w(e){if(!T(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function b(e,t){w(e);var n=e.startContainer,o=e.startOffset,i=e.endContainer,r=e.endOffset,a=n===i;U(i)&&r>0&&r<i.length&&V(i,r,t),U(n)&&o>0&&o<n.length&&(n=V(n,o,t),a?(r-=o,i=n):i==n.parentNode&&r>=W(n)&&r++,o=0),e.setStartAndEnd(n,o,i,r)}function x(e){w(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function A(e){e.START_TO_START=de,e.START_TO_END=ue,e.END_TO_END=fe,e.END_TO_START=he,e.NODE_BEFORE=ge,e.NODE_AFTER=me,e.NODE_BEFORE_AND_AFTER=pe,e.NODE_INSIDE=ve}function _(e){A(e),A(e.prototype)}function O(e,t){return function(){w(this);var n=this.startContainer,o=this.startOffset,i=this.commonAncestorContainer,a=new g(this,!0),s,l;n!==i&&(s=K(n,i,!0),l=r(s),n=l.node,o=l.offset),c(a,E),a.reset();var d=e(a);return a.detach(),t(this,n,o,n,o),d}}function M(t,o){function a(e,t){return function(n){v(n,Q),v(X(n),Z);var o=(e?i:r)(n);(t?s:l)(this,o.node,o.offset)}}function s(e,t,n){var i=e.endContainer,r=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((X(t)!=X(i)||1==F(t,n,i,r))&&(i=t,r=n),o(e,t,n,i,r))}function l(e,t,n){var i=e.startContainer,r=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((X(t)!=X(i)||-1==F(t,n,i,r))&&(i=t,r=n),o(e,i,r,t,n))}var c=function(){};c.prototype=e.rangePrototype,t.prototype=new c,H.extend(t.prototype,{setStart:function(e,t){p(e,!0),C(e,t),s(this,e,t)},setEnd:function(e,t){p(e,!0),C(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],i=t,r=n;switch(e.length){case 3:r=e[2];break;case 4:i=e[2],r=e[3]}o(this,t,n,i,r)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){w(this),e?o(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):o(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){p(e,!0),o(this,e,0,e,q(e))},selectNode:function(e){p(e,!1),v(e,Q);var t=i(e),n=r(e);o(this,t.node,t.offset,n.node,n.offset)},extractContents:O(u,o),deleteContents:O(d,o),canSurroundContents:function(){w(this),E(this.startContainer),E(this.endContainer);var e=new g(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},splitBoundaries:function(){b(this)},splitBoundariesPreservingPositions:function(e){b(this,e)},normalizeBoundaries:function(){w(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,r=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,i=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(o){var r=o.previousSibling;if(r&&r.nodeType==o.nodeType){e=o;var a=o.length;if(t=r.length,o.insertData(0,r.data),r.parentNode.removeChild(r),e==n)i+=t,n=e;else if(n==o.parentNode){var s=W(o);i==s?(n=o,i=a):i>s&&i--}}},s=!0;if(U(n))n.length==i&&r(n);else{if(i>0){var l=n.childNodes[i-1];l&&U(l)&&r(l)}s=!this.collapsed}if(s){if(U(e))0==t&&a(e);else if(t<e.childNodes.length){var c=e.childNodes[t];c&&U(c)&&a(c)}}else e=n,t=i;o(this,e,t,n,i)},collapseToPoint:function(e,t){p(e,!0),C(e,t),this.setStartAndEnd(e,t)}}),_(t)}function L(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:P.getCommonAncestor(e.startContainer,e.endContainer)}function k(e,t,n,o,i){e.startContainer=t,e.startOffset=n,e.endContainer=o,e.endOffset=i,e.document=P.getDocument(t),L(e)}function D(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,L(this)}var P=e.dom,H=e.util,I=P.DomPosition,B=e.DOMException,U=P.isCharacterDataNode,W=P.getNodeIndex,z=P.isOrIsAncestorOf,j=P.getDocument,F=P.comparePoints,V=P.splitDataNode,K=P.getClosestAncestorIn,q=P.getNodeLength,G=P.arrayContains,X=P.getRootContainer,Y=e.features.crashyTextNodes;g.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,U(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,n;!U(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,n=e===this.ec?this.eo:e.length,t!=n&&e.deleteData(t,n-t))},isPartiallySelectedSubtree:function(){var e=this._current;return n(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new D(o(this.range));var t=this._current,n=t,i=0,r=t,a=q(t);z(t,this.sc)&&(n=this.sc,i=this.so),z(t,this.ec)&&(r=this.ec,a=this.eo),k(e,n,i,r,a)}return new g(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Q=[1,3,4,5,7,8,10],Z=[2,9,11],J=[5,6,10,12],ee=[1,3,4,5,7,8,10,11],te=[1,3,4,5,7,8],ne=m([9,11]),oe=m(J),ie=m([6,10,12]),re=document.createElement("style"),ae=!1;try{re.innerHTML="<b>x</b>",ae=3==re.firstChild.nodeType}catch(se){}e.features.htmlParsingConforms=ae;var le=ae?function(e){var t=this.startContainer,n=j(t);if(!t)throw new B("INVALID_STATE_ERR");var o=null;return 1==t.nodeType?o=t:U(t)&&(o=P.parentElement(t)),o=null===o||"HTML"==o.nodeName&&P.isHtmlNamespace(j(o).documentElement)&&P.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1),o.innerHTML=e,P.fragmentFromNodeChildren(o)}:function(e){var t=o(this),n=t.createElement("body");return n.innerHTML=e,P.fragmentFromNodeChildren(n)},ce=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],de=0,ue=1,fe=2,he=3,ge=0,me=1,pe=2,ve=3;H.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){w(this),y(this.startContainer,t.startContainer);var n,o,i,r,a=e==he||e==de?"start":"end",s=e==ue||e==de?"start":"end";return n=this[a+"Container"],o=this[a+"Offset"],i=t[s+"Container"],r=t[s+"Offset"],F(n,o,i,r)},insertNode:function(e){if(w(this),v(e,ee),E(this.startContainer),z(e,this.startContainer))throw new B("HIERARCHY_REQUEST_ERR");var t=a(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){w(this);var e,t;if(this.collapsed)return o(this).createDocumentFragment();if(this.startContainer===this.endContainer&&U(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=o(this).createDocumentFragment(),t.appendChild(e),t;var n=new g(this,!0);return e=l(n),n.detach(),e},canSurroundContents:function(){w(this),E(this.startContainer),E(this.endContainer);var e=new g(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},surroundContents:function(e){if(v(e,te),!this.canSurroundContents())throw new B("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);a(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){w(this);for(var e=new D(o(this)),t=ce.length,n;t--;)n=ce[t],e[n]=this[n];return e},toString:function(){w(this);var e=this.startContainer;if(e===this.endContainer&&U(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new g(this,!0);return c(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){w(this);var t=e.parentNode,n=W(e);if(!t)throw new B("NOT_FOUND_ERR");var o=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return 0>o?i>0?pe:ge:i>0?me:ve},comparePoint:function(e,t){return w(this),R(e,"HIERARCHY_REQUEST_ERR"),y(e,this.startContainer),F(e,t,this.startContainer,this.startOffset)<0?-1:F(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:le,toHtml:function(){return x(this)},intersectsNode:function(e,t){if(w(this),R(e,"NOT_FOUND_ERR"),j(e)!==o(this))return!1;var n=e.parentNode,i=W(e);R(n,"NOT_FOUND_ERR");var r=F(n,i,this.endContainer,this.endOffset),a=F(n,i+1,this.startContainer,this.startOffset);return t?0>=r&&a>=0:0>r&&a>0},isPointInRange:function(e,t){return w(this),R(e,"HIERARCHY_REQUEST_ERR"),y(e,this.startContainer),F(e,t,this.startContainer,this.startOffset)>=0&&F(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return s(this,e,!1)},intersectsOrTouchesRange:function(e){return s(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=F(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=F(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange();return-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==F(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==F(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new B("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ve},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,q(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var o=n.pop();return t.setEnd(o,o.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return w(this),f(this,e,t)},getDocument:function(){return o(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var n=o(this),i=e.createRange(n);t=t||P.getBody(n),i.selectNodeContents(t);var r=this.intersection(i),a=0,s=0;return r&&(i.setEnd(r.startContainer,r.startOffset),a=i.toString().length,s=a+r.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var o=[t],i,r=!1,a=!1,s,l,c;!a&&(i=o.pop());)if(3==i.nodeType)s=n+i.length,!r&&e.start>=n&&e.start<=s&&(this.setStart(i,e.start-n),r=!0),r&&e.end>=n&&e.end<=s&&(this.setEnd(i,e.end-n),a=!0),n=s;else for(c=i.childNodes,l=c.length;l--;)o.push(c[l])},getName:function(){return"DomRange"},equals:function(e){return D.rangesEqual(this,e)},isValid:function(){return T(this)},inspect:function(){return h(this)},detach:function(){}}),M(D,k),H.extend(D,{rangeProperties:ce,RangeIterator:g,copyComparisonConstants:_,createPrototypeRange:M,inspect:h,toHtml:x,getRangeDocument:o,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=D}),O.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,o,i=e.dom,r=e.util,a=i.DomPosition,s=e.DomRange,l=i.getBody,c=i.getContentDocument,d=i.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function o(e){for(var t=u.length,n;t--;)n=u[t],e[n]=e.nativeRange[n];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,o,i){var r=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==o||e.endOffset!=i,s=!e.equals(e.nativeRange);(r||a||s)&&(e.setEnd(o,i),e.setStart(t,n))}var d,u=s.rangeProperties,f;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,o(this)},s.createPrototypeRange(n,a),d=n.prototype,d.selectNode=function(e){this.nativeRange.selectNode(e),o(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(e){this.nativeRange.surroundContents(e),o(this)},d.collapse=function(e){this.nativeRange.collapse(e),o(this)},d.cloneRange=function(){return new n(this.nativeRange.cloneRange())},d.refresh=function(){o(this)},d.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");l(document).appendChild(h);var g=document.createRange();g.setStart(h,0),g.setEnd(h,0);try{g.setStart(h,1),d.setStart=function(e,t){this.nativeRange.setStart(e,t),o(this)},d.setEnd=function(e,t){this.nativeRange.setEnd(e,t),o(this)},f=function(e){return function(t){this.nativeRange[e](t),o(this)}}}catch(m){d.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}o(this)},d.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}o(this)},f=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(i){this.nativeRange[t](n),this.nativeRange[e](n)}o(this)}}}d.setStartBefore=f("setStartBefore","setEndBefore"),
d.setStartAfter=f("setStartAfter","setEndAfter"),d.setEndBefore=f("setEndBefore","setStartBefore"),d.setEndAfter=f("setEndAfter","setStartAfter"),d.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},g.selectNodeContents(h),g.setEnd(h,3);var p=document.createRange();p.selectNodeContents(h),p.setEnd(h,4),p.setStart(h,2),-1==g.compareBoundaryPoints(g.START_TO_END,p)&&1==g.compareBoundaryPoints(g.END_TO_START,p)?d.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:d.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");v.innerHTML="123";var C=v.firstChild,y=l(document);y.appendChild(v),g.setStart(C,1),g.setEnd(C,2),g.deleteContents(),"13"==C.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),o(this)},d.extractContents=function(){var e=this.nativeRange.extractContents();return o(this),e}),y.removeChild(v),y=null,r.isHostMethod(g,"createContextualFragment")&&(d.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(h),d.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var o=n.parentElement();n=e.duplicate(),n.collapse(!1);var r=n.parentElement(),a=o==r?o:i.getCommonAncestor(o,r);return a==t?a:i.getCommonAncestor(t,a)},f=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,o,r){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(i.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new a(l.parentNode,i.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var u=i.getDocument(l).createElement("span");u.parentNode&&u.parentNode.removeChild(u);for(var f,h=n?"StartToStart":"StartToEnd",g,m,p,v,C=r&&r.containerElement==l?r.nodeIndex:0,y=l.childNodes.length,E=y,R=E;;){if(R==y?l.appendChild(u):l.insertBefore(u,l.childNodes[R]),s.moveToElementText(u),f=s.compareEndPoints(h,e),0==f||C==E)break;if(-1==f){if(E==C+1)break;C=R}else E=E==C+1?C:R;R=Math.floor((C+E)/2),l.removeChild(u)}if(v=u.nextSibling,-1==f&&v&&d(v)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var N;if(/[\r\n]/.test(v.data)){var S=s.duplicate(),T=S.text.replace(/\r\n/g,"\r").length;for(N=S.moveStart("character",T);-1==(f=S.compareEndPoints("StartToEnd",S));)N++,S.moveStart("character",1)}else N=s.text.length;p=new a(v,N)}else g=(o||!n)&&u.previousSibling,m=(o||n)&&u.nextSibling,p=m&&d(m)?new a(m,0):g&&d(g)?new a(g,g.data.length):new a(l,i.getNodeIndex(u));return u.parentNode.removeChild(u),{boundaryPosition:p,nodeInfo:{nodeIndex:R,containerElement:l}}},g=function(e,t){var n,o,r=e.offset,a=i.getDocument(e.node),s,c,u=l(a).createTextRange(),f=d(e.node);return f?(n=e.node,o=n.parentNode):(c=e.node.childNodes,n=r<c.length?c[r]:null,o=e.node),s=a.createElement("span"),s.innerHTML="&#feff;",n?o.insertBefore(s,n):o.appendChild(s),u.moveToElementText(s),u.collapse(!t),o.removeChild(s),f&&u[t?"moveStart":"moveEnd"]("character",r),u};o=function(e){this.textRange=e,this.refresh()},o.prototype=new s(document),o.prototype.refresh=function(){var e,t,n,o=u(this.textRange);f(this.textRange)?t=e=h(this.textRange,o,!0,!0).boundaryPosition:(n=h(this.textRange,o,!0,!1),e=n.boundaryPosition,t=h(this.textRange,o,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},o.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(o);var m=function(e){if(e.collapsed)return g(new a(e.startContainer,e.startOffset),!0);var t=g(new a(e.startContainer,e.startOffset),!0),n=g(new a(e.endContainer,e.endOffset),!1),o=l(s.getRangeDocument(e)).createTextRange();return o.setEndPoint("StartToStart",t),o.setEndPoint("EndToEnd",n),o};if(o.rangeToTextRange=m,o.prototype.toTextRange=function(){return m(this)},e.WrappedTextRange=o,!e.features.implementsDomRange||e.config.preferTextRange){var p=function(e){return e("return this;")()}(Function);"undefined"==typeof p.Range&&(p.Range=o),e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=o}}e.createRange=function(n){return n=c(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=c(e,t,"createRangyRange"),new s(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addShimListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),O.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function o(e,n){if(e){if(b.isWindow(e))return e;if(e instanceof v)return e.win;var o=b.getContentDocument(e,t,n);return b.getWindow(o)}return window}function i(e){return o(e,"getWinSelection").getSelection()}function r(e){return o(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==b.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var o=n?"end":"start",i=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function c(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function d(t){var n;return t instanceof _?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof O?n=t.nativeRange:P.implementsDomRange&&t instanceof b.getWindow(t.startContainer).Range&&(n=t),n}function u(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!b.isAncestorOf(e[0],e[t]))return!1;return!0}function f(e){var n=e.getNodes();if(!u(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function h(e){return!!e&&"undefined"!=typeof e.text}function g(e,t){var n=new O(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function m(t){if(t._ranges.length=0,"None"==t.docSelection.type)c(t);else{var n=t.docSelection.createRange();if(h(n))g(t,n);else{t.rangeCount=n.length;for(var o,i=I(n.item(0)),r=0;r<t.rangeCount;++r)o=e.createRange(i),o.selectNode(n.item(r)),t._ranges.push(o);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function p(e,n){for(var o=e.docSelection.createRange(),i=f(n),r=I(o.item(0)),a=B(r).createControlRange(),s=0,l=o.length;l>s;++s)a.add(o.item(s));try{a.add(i)}catch(c){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),m(e)}function v(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function C(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function y(e,t){for(var n=ne.length,o,i;n--;)if(o=ne[n],i=o.selection,"deleteAll"==t)C(i);else if(o.win==e)return"delete"==t?(ne.splice(n,1),!0):i;return"deleteAll"==t&&(ne.length=0),null}function E(e,n){for(var o=I(n[0].startContainer),i=B(o).createControlRange(),r=0,a,s=n.length;s>r;++r){a=f(n[r]);try{i.add(a)}catch(l){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),m(e)}function R(e,t){if(e.win.document!=I(t))throw new M("WRONG_DOCUMENT_ERR")}function N(t){return function(n,o){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](n,o)):(i=e.createRange(this.win.document),i.setStartAndEnd(n,o)),this.setSingleRange(i,this.isBackward())}}function S(e){var t=[],n=new L(e.anchorNode,e.anchorOffset),o=new L(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var r=0,a=e.rangeCount;a>r;++r)t[r]=_.inspect(e.getRangeAt(r));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}e.config.checkSelectionRanges=!0;var T="boolean",w="number",b=e.dom,x=e.util,A=x.isHostMethod,_=e.DomRange,O=e.WrappedRange,M=e.DOMException,L=b.DomPosition,k,D,P=e.features,H="Control",I=b.getDocument,B=b.getBody,U=_.rangesEqual,W=A(window,"getSelection"),z=x.isHostObject(document,"selection");P.implementsWinGetSelection=W,P.implementsDocSelection=z;var j=z&&(!W||e.config.preferTextRange);j?(k=r,e.isSelectionValid=function(e){var t=o(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||I(n.createRange().parentElement())==t}):W?(k=i,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=k;var F=k(),V=e.createNativeRange(document),K=B(document),q=x.areHostProperties(F,["anchorNode","focusNode","anchorOffset","focusOffset"]);P.selectionHasAnchorAndFocus=q;var G=A(F,"extend");P.selectionHasExtend=G;var X=typeof F.rangeCount==w;P.selectionHasRangeCount=X;var Y=!1,Q=!0,Z=G?function(t,n){var o=_.getRangeDocument(n),i=e.createRange(o);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(d(i)),t.extend(n.startContainer,n.startOffset)}:null;x.areHostMethods(F,["addRange","getRangeAt","removeAllRanges"])&&typeof F.rangeCount==w&&P.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,o=n>1,i=[],r=a(t),s=0;n>s;++s)i[s]=t.getRangeAt(s);var l=B(document),c=l.appendChild(document.createElement("div"));c.contentEditable="false";var d=c.appendChild(document.createTextNode("   ")),u=document.createRange();if(u.setStart(d,1),u.collapse(!0),t.addRange(u),Q=1==t.rangeCount,t.removeAllRanges(),!o){var f=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(f&&parseInt(f[1])>=36)Y=!1;else{var h=u.cloneRange();u.setStart(d,0),h.setEnd(d,3),h.setStart(d,2),t.addRange(u),t.addRange(h),Y=2==t.rangeCount}}for(l.removeChild(c),t.removeAllRanges(),s=0;n>s;++s)0==s&&r?Z?Z(t,i[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(i[s])):t.addRange(i[s])}}(),P.selectionSupportsMultipleRanges=Y,P.collapsedNonEditableSelectionsSupported=Q;var J=!1,ee;K&&A(K,"createControlRange")&&(ee=K.createControlRange(),x.areHostProperties(ee,["item","add"])&&(J=!0)),P.implementsControlRange=J,D=q?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var te;A(F,"getRangeAt")?te=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:q&&(te=function(t){var n=I(t.anchorNode),o=e.createRange(n);return o.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),o.collapsed!==this.isCollapsed&&o.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),o}),v.prototype=e.selectionPrototype;var ne=[],oe=function(e){if(e&&e instanceof v)return e.refresh(),e;e=o(e,"getNativeSelection");var t=y(e),n=k(e),i=z?r(e):null;return t?(t.nativeSelection=n,t.docSelection=i,t.refresh()):(t=new v(n,i,e),ne.push({win:e,selection:t})),t};e.getSelection=oe,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(b.getIframeWindow(n))};var ie=v.prototype;if(!j&&q&&x.areHostMethods(F,["removeAllRanges","addRange"])){ie.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)};var re=function(e,t){Z(e.nativeSelection,t),e.refresh()};X?ie.addRange=function(t,o){if(J&&z&&this.docSelection.type==H)p(this,t);else if(n(o)&&G)re(this,t);else{var i;Y?i=this.rangeCount:(this.removeAllRanges(),i=0);var r=d(t).cloneRange();try{this.nativeSelection.addRange(r)}catch(a){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1){if(e.config.checkSelectionRanges){var l=te(this.nativeSelection,this.rangeCount-1);l&&!U(l,t)&&(t=new O(l))}this._ranges[this.rangeCount-1]=t,s(this,t,le(this.nativeSelection)),this.isCollapsed=D(this)}else this.refresh()}}:ie.addRange=function(e,t){n(t)&&G?re(this,e):(this.nativeSelection.addRange(d(e)),this.refresh())},ie.setRanges=function(e){if(J&&z&&e.length>1)E(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(A(F,"empty")&&A(V,"select")&&J&&j))return t.fail("No means of selecting a Range or TextRange was found"),!1;ie.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=I(this.anchorNode);else if(this.docSelection.type==H){var t=this.docSelection.createRange();t.length&&(e=I(t.item(0)))}if(e){var n=B(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(o){}c(this)},ie.addRange=function(t){this.docSelection.type==H?p(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},ie.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?E(this,e):t&&this.addRange(e[0])}}ie.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new M("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var ae;if(j)ae=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=B(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==H?m(t):h(n)?g(t,n):c(t)};else if(A(F,"getRangeAt")&&typeof F.rangeCount==w)ae=function(t){if(J&&z&&t.docSelection.type==H)m(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,o=t.rangeCount;o>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],le(t.nativeSelection)),t.isCollapsed=D(t)}else c(t)};else{if(!q||typeof F.isCollapsed!=T||typeof V.collapsed!=T||!P.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ae=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=te(n,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=D(e)):c(e)}}ie.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(ae(this),e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;i--;)if(!U(t[i],this._ranges[i]))return!0;return!1}};var se=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var o=0,i=n.length;i>o;++o)U(t,n[o])||e.addRange(n[o]);e.rangeCount||c(e)};J&&z?ie.removeRange=function(e){if(this.docSelection.type==H){for(var t=this.docSelection.createRange(),n=f(e),o=I(t.item(0)),i=B(o).createControlRange(),r,a=!1,s=0,l=t.length;l>s;++s)r=t.item(s),r!==n||a?i.add(t.item(s)):a=!0;i.select(),m(this)}else se(this,e)}:ie.removeRange=function(e){se(this,e)};var le;!j&&q&&P.implementsDomRange?(le=a,ie.isBackward=function(){return le(this)}):le=ie.isBackward=function(){return!1},ie.isBackwards=ie.isBackward,ie.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},ie.collapse=function(t,n){R(this,t);var o=e.createRange(t);o.collapseToPoint(t,n),this.setSingleRange(o),this.isCollapsed=!0},ie.collapseToStart=function(){if(!this.rangeCount)throw new M("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ie.collapseToEnd=function(){if(!this.rangeCount)throw new M("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ie.selectAllChildren=function(t){R(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},ie.deleteFromDocument=function(){if(J&&z&&this.docSelection.type==H){for(var e=this.docSelection.createRange(),t;e.length;)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,i=n.length;i>o;++o)n[o].deleteContents();this.addRange(n[i-1])}}},ie.eachRange=function(e,t){for(var n=0,o=this._ranges.length;o>n;++n)if(e(this.getRangeAt(n)))return t},ie.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ie.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ie.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(o){n.push(o[e].apply(o,t))}),n},ie.setStart=N(!0),ie.setEnd=N(!1),e.rangePrototype.select=function(e){oe(this.getDocument()).setSingleRange(this,e)},ie.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ie.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},ie.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ie.moveToBookmark=function(t){for(var n=[],o=0,i,r;i=t.rangeBookmarks[o++];)r=e.createRange(this.win),r.moveToBookmark(i),n.push(r);t.backward?this.setSingleRange(n[0],"backward"):this.setRanges(n)},ie.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(_.toHtml(t))}),e.join("")},P.implementsTextRange&&(ie.getNativeTextRange=function(){var n,o;if(n=this.docSelection){var i=n.createRange();if(h(i))return i;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ie.getName=function(){return"WrappedSelection"},ie.inspect=function(){return S(this)},ie.detach=function(){y(this.win,"delete"),C(this)},v.detachAll=function(){y(null,"deleteAll")},v.inspect=S,v.isDirectionBackward=n,e.Selection=v,e.selectionPrototype=ie,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return oe(e)}),e=null})});var P=!1,H=function(e){P||(P=!0,!O.initialized&&O.config.autoInitialize&&u())};return A&&("complete"==document.readyState?H():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",H,!1),L(window,"load",H))),O},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){e.createModule("ClassApplier",["WrappedSelection"],function(e,t){function n(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)return!1;return!0}function o(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function i(e){return e&&e.split(/\s+/).sort().join(" ")}function r(e){return i(e.className)}function a(e,t){return r(e)==r(t)}function s(e,t,n,o,i){var r=e.node,a=e.offset,s=r,l=a;r==o&&a>i&&++l,r!=t||a!=n&&a!=n+1||(s=o,l+=i-n),r==t&&a>n+1&&--l,e.node=s,e.offset=l}function l(e,t,n){e.node==t&&e.offset>n&&--e.offset}function c(e,t,n,o){-1==n&&(n=t.childNodes.length);for(var i=e.parentNode,r=O.getNodeIndex(e),a=0,l;l=o[a++];)s(l,i,r,t,n);t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function d(e,t){for(var n=e.parentNode,o=O.getNodeIndex(e),i=0,r;r=t[i++];)l(r,n,o);e.parentNode.removeChild(e)}function u(e,t,n,o,i){for(var r,a=[];r=e.firstChild;)c(r,t,n++,i),a.push(r);return o&&d(e,i),a}function f(e,t){return u(e,e.parentNode,O.getNodeIndex(e),!0,t)}function h(e,t){var n=e.cloneRange();n.selectNodeContents(t);var o=n.intersection(e),i=o?o.toString():"";return""!=i}function g(e){for(var t=e.getNodes([3]),n=0,o;(o=t[n])&&!h(e,o);)++n;for(var i=t.length-1;(o=t[i])&&!h(e,o);)--i;return t.slice(n,i+1)}function m(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n=0,o=e.attributes.length,i,r,a;o>n;++n)if(i=e.attributes[n],a=i.name,"class"!=a){if(r=t.attributes.getNamedItem(a),null===i!=(null===r))return!1;if(i.specified!=r.specified)return!1;if(i.specified&&i.nodeValue!==r.nodeValue)return!1}return!0}function p(e,t){for(var n=0,o=e.attributes.length,i;o>n;++n)if(i=e.attributes[n].name,(!t||!L(t,i))&&e.attributes[n].specified&&"class"!=i)return!0;return!1}function v(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||U(e)&&!U(e.parentNode))}function C(e){return(U(e)||1!=e.nodeType&&U(e.parentNode))&&!v(e)}function y(e){return e&&1==e.nodeType&&!W.test(B(e,"display"))}function E(e){if(0==e.data.length)return!0;if(z.test(e.data))return!1;var t=B(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return y(e.previousSibling)||y(e.nextSibling)}function R(e){var t=[],n,o;for(n=0;o=e[n++];)t.push(new M(o.startContainer,o.startOffset),new M(o.endContainer,o.endOffset));return t}function N(e,t){for(var n=0,o,i,r,a=e.length;a>n;++n)o=e[n],i=t[2*n],r=t[2*n+1],o.setStartAndEnd(i.node,i.offset,r.node,r.offset)}function S(e,t){return O.isCharacterDataNode(e)?0==t?!!e.previousSibling:t==e.length?!!e.nextSibling:!0:t>0&&t<e.childNodes.length}function T(e,n,o,i){var r,a,s=0==o;if(O.isAncestorOf(n,e))return e;if(O.isCharacterDataNode(n)){var l=O.getNodeIndex(n);if(0==o)o=l;else{if(o!=n.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+o+" in "+n.data);o=l+1}n=n.parentNode}if(S(n,o)){r=n.cloneNode(!1),a=n.parentNode,r.id&&r.removeAttribute("id");for(var d,u=0;d=n.childNodes[o];)c(d,r,u++,i);return c(r,a,O.getNodeIndex(n)+1,i),n==e?r:T(e,a,O.getNodeIndex(r),i)}if(e!=n){r=n.parentNode;var f=O.getNodeIndex(n);return s||f++,T(e,r,f,i)}return e}function w(e,t){return e.namespaceURI==t.namespaceURI&&e.tagName.toLowerCase()==t.tagName.toLowerCase()&&a(e,t)&&m(e,t)&&"inline"==B(e,"display")&&"inline"==B(t,"display")}function b(e){var t=e?"nextSibling":"previousSibling";return function(n,o){var i=n.parentNode,r=n[t];if(r){if(r&&3==r.nodeType)return r}else if(o&&(r=i[t],r&&1==r.nodeType&&w(i,r))){var a=r[e?"firstChild":"lastChild"];if(a&&3==a.nodeType)return a}return null}}function x(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function A(e,t,r){var a,s,l,c,d=this;d.cssClass=d.className=e;var u=null,f={};if("object"==typeof t&&null!==t){for("undefined"!=typeof t.elementTagName&&(t.elementTagName=t.elementTagName.toLowerCase()),r=t.tagNames,u=t.elementProperties,f=t.elementAttributes,s=0;c=V[s++];)t.hasOwnProperty(c)&&(d[c]=t[c]);a=t.normalize}else a=t;d.normalize="undefined"==typeof a?!0:a,d.attrExceptions=[];var h=document.createElement(d.elementTagName);d.elementProperties=d.copyPropertiesToElement(u,h,!0),n(f,function(e){d.attrExceptions.push(e)}),d.elementAttributes=f,d.elementSortedClassName=d.elementProperties.hasOwnProperty("className")?i(d.elementProperties.className+" "+e):e,d.applyToAnyTagName=!1;var g=typeof r;if("string"==g)"*"==r?d.applyToAnyTagName=!0:d.tagNames=o(r.toLowerCase()).split(/\s*,\s*/);else if("object"==g&&"number"==typeof r.length)for(d.tagNames=[],s=0,l=r.length;l>s;++s)"*"==r[s]?d.applyToAnyTagName=!0:d.tagNames.push(r[s].toLowerCase());else d.tagNames=[d.elementTagName]}function _(e,t,n){return new A(e,t,n)}var O=e.dom,M=O.DomPosition,L=O.arrayContains,k=O.isHtmlNamespace,D="span",P,H,I;e.util.isHostObject(document.createElement("div"),"classList")?(P=function(e,t){return e.classList.contains(t)},H=function(e,t){return e.classList.add(t)},I=function(e,t){return e.classList.remove(t)}):(P=function(e,t){return e.className&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e.className)},H=function(e,t){e.className?P(e,t)||(e.className+=" "+t):e.className=t},I=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){t.className&&(t.className=t.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e))}}());var B=O.getComputedStyleProperty,U=function(){var e=document.createElement("div");return"boolean"==typeof e.isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return e&&1==e.nodeType&&"false"!=e.contentEditable?"true"==e.contentEditable||U(e.parentNode):!1}}(),W=/^inline(-block|-table)?$/i,z=/[^\r\n\t\f \u200B]/,j=b(!1),F=b(!0);x.prototype={doMerge:function(e){var t=this.textNodes,n=t[0];if(t.length>1){for(var o=O.getNodeIndex(n),i=[],r=0,a,s,l=0,c=t.length,d,u;c>l;++l){if(a=t[l],s=a.parentNode,l>0&&(s.removeChild(a),s.hasChildNodes()||s.parentNode.removeChild(s),e))for(d=0;u=e[d++];)u.node==a&&(u.node=n,u.offset+=r),u.node==s&&u.offset>o&&(--u.offset,u.offset==o+1&&c-1>l&&(u.node=n,u.offset=r));i[l]=a.data,r+=a.data.length}n.data=i.join("")}return n.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;n>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}};var V=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],K={};A.prototype={elementTagName:D,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var o,r,a={},s,l,c,d;for(var u in e)if(e.hasOwnProperty(u))if(l=e[u],c=t[u],"className"==u)H(t,l),H(t,this.className),t[u]=i(t[u]),n&&(a[u]=l);else if("style"==u){r=c,n&&(a[u]=s={});for(o in e[u])e[u].hasOwnProperty(o)&&(r[o]=l[o],n&&(s[o]=r[o]));this.attrExceptions.push(u)}else t[u]=l,n&&(a[u]=t[u],d=K.hasOwnProperty(u)?K[u]:u,this.attrExceptions.push(d));return n?a:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])},hasClass:function(e){return 1==e.nodeType&&(this.applyToAnyTagName||L(this.tagNames,e.tagName.toLowerCase()))&&P(e,this.className)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||C(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&E(e)},postApply:function(e,t,n,o){for(var i=e[0],r=e[e.length-1],a=[],s,l=i,c=r,d=0,u=r.length,f,h,g=0,m=e.length;m>g;++g)f=e[g],h=j(f,!o),h?(s||(s=new x(h),a.push(s)),s.textNodes.push(f),f===i&&(l=s.textNodes[0],d=l.length),f===r&&(c=s.textNodes[0],u=s.getLength())):s=null;var p=F(r,!o);if(p&&(s||(s=new x(r),a.push(s)),s.textNodes.push(p)),a.length){for(g=0,m=a.length;m>g;++g)a[g].doMerge(n);t.setStartAndEnd(l,d,c,u)}},createContainer:function(e){var t=e.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,t,!1),this.copyAttributesToElement(this.elementAttributes,t),H(t,this.className),this.onElementCreate&&this.onElementCreate(t,this),t},elementHasProperties:function(e,t){var o=this;return n(t,function(t,n){if("className"==t)return i(e.className)==o.elementSortedClassName;if("object"==typeof n){if(!o.elementHasProperties(e[t],n))return!1}else if(e[t]!==n)return!1})},applyToTextNode:function(e,t){var n=e.parentNode;if(1==n.childNodes.length&&this.useExistingElements&&k(n)&&L(this.tagNames,n.tagName.toLowerCase())&&this.elementHasProperties(n,this.elementProperties))H(n,this.className);else{var o=this.createContainer(O.getDocument(e));e.parentNode.insertBefore(o,e),o.appendChild(e)}},isRemovable:function(e){return k(e)&&e.tagName.toLowerCase()==this.elementTagName&&r(e)==this.elementSortedClassName&&this.elementHasProperties(e,this.elementProperties)&&!p(e,this.attrExceptions)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){for(var t=this,n=e.getNodes([1],function(e){return t.isEmptyContainer(e)}),o=[e],i=R(o),r=0,a;a=n[r++];)d(a,i);N(o,i)},undoToTextNode:function(e,t,n,o){if(!t.containsNode(n)){var i=t.cloneRange();i.selectNode(n),i.isPointInRange(t.endContainer,t.endOffset)&&(T(n,t.endContainer,t.endOffset,o),t.setEndAfter(n)),i.isPointInRange(t.startContainer,t.startOffset)&&(n=T(n,t.startContainer,t.startOffset,o))}this.isRemovable(n)?f(n,o):I(n,this.className)},splitAncestorWithClass:function(e,t,n){var o=this.getSelfOrAncestorWithClass(e);o&&T(o,e,t,n)},undoToAncestor:function(e,t){this.isRemovable(e)?f(e,t):I(e,this.className)},applyToRange:function(e,t){t=t||[];var n=R(t||[]);e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e);var o=g(e);if(o.length){for(var i=0,r;r=o[i++];)this.isIgnorableWhiteSpaceNode(r)||this.getSelfOrAncestorWithClass(r)||!this.isModifiable(r)||this.applyToTextNode(r,n);r=o[o.length-1],e.setStartAndEnd(o[0],0,r,r.length),this.normalize&&this.postApply(o,e,n,!1),N(t,n)}},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){t=t||[];var n=R(t);e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e,n);var o=g(e),i,r,a=o[o.length-1];if(o.length){this.splitAncestorWithClass(e.endContainer,e.endOffset,n),this.splitAncestorWithClass(e.startContainer,e.startOffset,n);for(var s=0,l=o.length;l>s;++s)i=o[s],r=this.getSelfOrAncestorWithClass(i),r&&this.isModifiable(i)&&this.undoToAncestor(r,n);e.setStartAndEnd(o[0],0,a,a.length),this.normalize&&this.postApply(o,e,n,!0),N(t,n)}},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),o=e.getSelection(t).getAllRanges();this.undoToRanges(o),n.setRanges(o)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n=0,o;o=t[n++];)if(!this.isIgnorableWhiteSpaceNode(o)&&h(e,o)&&this.isModifiable(o)&&!this.getSelfOrAncestorWithClass(o))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var o=n.getSelfOrAncestorWithClass(e);o&&!L(t,o)&&t.push(o)}),t},detach:function(){}},A.util={hasClass:P,addClass:H,removeClass:I,hasSameClasses:a,replaceWithOwnChildren:f,elementsHaveSameNonClassAttributes:m,elementHasNonClassAttributes:p,splitNodeAt:T,isEditableElement:U,isEditingHost:v,isEditable:C},e.CssClassApplier=e.ClassApplier=A,e.createCssClassApplier=e.createClassApplier=_})},this),function(e,t){"use strict";var n=e.rangy||null,o=e.Undo||null,i=e.Key={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,pageUp:33,pageDown:34,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindow:91,rightWindowKey:92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,
numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145,semiColon:186,equalSign:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backSlash:220,closeBracket:221,singleQuote:222},r=function(){var o=function(e){var t=this,n=a.deepExtend({},o.defaultSettings),r=this.settings=a.deepExtend(n,e),s=new o.Cache,l=new o.Selection,c=new o.Action(this),d=new o.Cursor(this),u=new o.Undoable(this),f,h,g;for(g in n)n.hasOwnProperty(g)&&"object"!=typeof n[g]&&n.hasOwnProperty(g)&&r.element.getAttribute("data-medium-"+i)&&(h=r.element.getAttribute("data-medium-"+i),("false"===h.toLowerCase()||"true"===h.toLowerCase())&&(h="true"===h.toLowerCase()),r[g]=h);if(r.modifiers)for(g in r.modifiers)r.modifiers.hasOwnProperty(g)&&"undefined"!=typeof i[g]&&(r.modifiers[i[g]]=r.modifiers[g]);if(r.keyContext)for(g in r.keyContext)r.keyContext.hasOwnProperty(g)&&"undefined"!=typeof i[g]&&(r.keyContext[i[g]]=r.keyContext[g]);f=r.element,f.contentEditable=!0,f.className+=" "+r.cssClasses.editor+(" "+r.cssClasses.editor+"-"+r.mode),r.tags=r.tags||{},r.tags.outerLevel&&(r.tags.outerLevel=r.tags.outerLevel.concat([r.tags.paragraph,r.tags.horizontalRule])),this.settings=r,this.element=f,f.medium=this,this.action=c,this.cache=s,this.cursor=d,this.utils=a,this.selection=l,t.clean(),t.placeholders(),c.preserveElementFocus(),this.dirty=!1,this.undoable=u,this.makeUndoable=u.makeUndoable,r.drag&&(t.drag=new o.Drag(t),t.drag.setup()),c.setup(),s.initialized=!0,this.makeUndoable(!0)};return o.prototype={placeholders:function(){if(e.getComputedStyle){var n=this.settings,i=this.placeholder||(this.placeholder=t.createElement("div")),r=this.element,s=i.style,l=e.getComputedStyle(r,null),c=function(e){return l.getPropertyValue(e)},d=a.text(r),u=this.cursor,f=r.children.length,h=o.activeElement===r;if(r.placeholder=i,!h&&d.length<1&&2>f){if(r.placeHolderActive)return;r.innerHTML.match("<"+n.tags.paragraph)||(r.innerHTML=""),n.placeholder.length>0&&(i.setup||(i.setup=!0,s.background=c("background"),s.backgroundColor=c("background-color"),s.fontSize=c("font-size"),s.color=l.color,s.marginTop=c("margin-top"),s.marginBottom=c("margin-bottom"),s.marginLeft=c("margin-left"),s.marginRight=c("margin-right"),s.paddingTop=c("padding-top"),s.paddingBottom=c("padding-bottom"),s.paddingLeft=c("padding-left"),s.paddingRight=c("padding-right"),s.borderTopWidth=c("border-top-width"),s.borderTopColor=c("border-top-color"),s.borderTopStyle=c("border-top-style"),s.borderBottomWidth=c("border-bottom-width"),s.borderBottomColor=c("border-bottom-color"),s.borderBottomStyle=c("border-bottom-style"),s.borderLeftWidth=c("border-left-width"),s.borderLeftColor=c("border-left-color"),s.borderLeftStyle=c("border-left-style"),s.borderRightWidth=c("border-right-width"),s.borderRightColor=c("border-right-color"),s.borderRightStyle=c("border-right-style"),i.className=n.cssClasses.placeholder+" "+n.cssClasses.placeholder+"-"+n.mode,i.innerHTML="<div>"+n.placeholder+"</div>",r.parentNode.insertBefore(i,r)),r.className+=" "+n.cssClasses.clear,s.display="",s.minHeight=r.clientHeight+"px",s.minWidth=r.clientWidth+"px",n.mode!==o.inlineMode&&n.mode!==o.inlineRichMode&&(this.setupContents(),0===f&&r.firstChild&&u.set(this,0,r.firstChild))),r.placeHolderActive=!0}else r.placeHolderActive&&(r.placeHolderActive=!1,s.display="none",r.className=a.trim(r.className.replace(n.cssClasses.clear,"")),this.setupContents())}},clean:function(n){var i=this.settings,r=i.cssClasses.placeholder,s=(i.attributes||{}).remove||[],l=i.tags||{},c=l.outerLevel||null,d=l.innerLevel||null,u={},f={},h=(l.paragraph||"").toUpperCase(),g=this.html,m,p,v;if(n=n||i.element,i.mode===o.inlineRichMode&&(c=i.tags.innerLevel),null!==c)for(v=0;v<c.length;v++)u[c[v].toUpperCase()]=!0;if(null!==d)for(v=0;v<d.length;v++)f[d[v].toUpperCase()]=!0;a.traverseAll(n,{element:function(n,o,i,l){var g=n.nodeName,C=!0,y;for(v=0;v<s.length;v++)m=s[v],n.hasAttribute(m)&&(y=n.getAttribute(m),y===r||y.match("medium-")||"class"!==m||n.removeAttribute(m));if((null!==c||null!==d)&&(1===i&&void 0!==u[g]?C=!1:i>1&&void 0!==f[g]&&(C=!1),C))if("block"===e.getComputedStyle(n,null).getPropertyValue("display")){if(h.length>0&&h!==g&&a.changeTag(n,h),i>1)for(;l.childNodes.length>o;)l.parentNode.insertBefore(l.lastChild,l.nextSibling)}else switch(g){case"BR":if(n===n.parentNode.lastChild){if(n===n.parentNode.firstChild)break;p=t.createTextNode(""),p.innerHTML="&nbsp",n.parentNode.insertBefore(p,n);break}default:for(;null!==n.firstChild;)n.parentNode.insertBefore(n.firstChild,n);a.detachNode(n)}}})},insertHtml:function(e,t,n){var i=new o.Html(this,e).insert(this.settings.beforeInsertHtml),r=i[i.length-1];switch(n===!0&&a.triggerEvent(this.element,"change"),t&&t.apply(i),r.nodeName){case"UL":case"OL":case"DL":if(null!==r.lastChild){this.cursor.moveCursorToEnd(r.lastChild);break}default:this.cursor.moveCursorToEnd(r)}return this},addTag:function(e,n,o,i){if(!this.settings.beforeAddTag(e,n,o,i)){var r=t.createElement(e),a;return"undefined"!=typeof o&&o===!1&&(r.contentEditable=!1),0==r.innerHTML.length&&(r.innerHTML=" "),i&&i.nextSibling?(i.parentNode.insertBefore(r,i.nextSibling),a=i.nextSibling):(this.element.appendChild(r),a=this.lastChild()),n&&(this.cache.focusedElement=a,this.cursor.set(this,0,a)),r}return null},invokeElement:function(e,t,n){var i=this.settings,r=t.remove||[];switch(t=t||{},i.mode){case o.inlineMode:case o.partialMode:return this}return r.length>0&&(a.arrayContains(i,"class")||r.push("class")),new o.Element(this,e,t).invoke(this.settings.beforeInvokeElement),n===!0&&a.triggerEvent(this.element,"change"),this},value:function(e){return"undefined"==typeof e?this.element.innerHTML:(this.element.innerHTML=e,this.clean(),this.placeholders(),this.makeUndoable(),this)},focus:function(){var e=this.element;return e.focus(),this},select:function(){return a.selectNode(o.activeElement=this.element),this},isActive:function(){return o.activeElement===this.element},setupContents:function(){var e=this.element,n=e.children,i=e.childNodes,r,a=this.settings;return!a.tags.paragraph||n.length>0||a.mode===o.inlineMode||a.mode===o.inlineRichMode?o.Utilities:(i.length>0?(r=t.createElement(a.tags.paragraph),e.innerHTML.match("^[&]nbsp[;]")&&(e.innerHTML=e.innerHTML.substring(6,e.innerHTML.length-1)),r.innerHTML=e.innerHTML,e.innerHTML="",e.appendChild(r)):(r=t.createElement(a.tags.paragraph),r.innerHTML="&nbsp;",e.appendChild(r),this.cursor.set(this,0,e.firstChild)),this)},destroy:function(){var e=this.element,t=this.settings,n=this.placeholder||null;null!==n&&n.setup&&null!==n.parentNode&&(n.parentNode.removeChild(n),delete e.placeHolderActive),e.removeAttribute("contenteditable"),e.className=a.trim(e.className.replace(t.cssClasses.editor,"").replace(t.cssClasses.clear,"").replace(t.cssClasses.editor+"-"+t.mode,"")),this.action.destroy(),this.settings.drag&&this.drag.destroy()},clear:function(){this.element.innerHTML="",this.placeholders()},splitAtCaret:function(){if(!this.isActive())return null;var n=e.getSelection||t.selection,o=n(),i=o.focusOffset,r=o.focusNode,a=this.element,s=t.createRange(),l=t.createRange(),c;return s.setStart(r,i),l.selectNodeContents(a),s.setEnd(l.endContainer,l.endOffset),c=s.extractContents()},deleteSelection:function(){if(this.isActive()){var e=n.getSelection(),t;e.rangeCount>0&&(t=e.getRangeAt(0),t.deleteContents())}},lastChild:function(){return this.element.lastChild},bold:function(){switch(this.settings.mode){case o.partialMode:case o.inlineMode:return this}return new o.Element(this,"bold").setClean(!1).invoke(this.settings.beforeInvokeElement),this},underline:function(){switch(this.settings.mode){case o.partialMode:case o.inlineMode:return this}return new o.Element(this,"underline").setClean(!1).invoke(this.settings.beforeInvokeElement),this},italicize:function(){switch(this.settings.mode){case o.partialMode:case o.inlineMode:return this}return new o.Element(this,"italic").setClean(!1).invoke(this.settings.beforeInvokeElement),this},quote:function(){return this},paste:function(e){var t=this.value(),n=t.length,i,r=this.settings,s=this.selection,l=this.element,c=this,d=function(e){e=e||"",e.length>0&&(l.focus(),o.activeElement=l,s.restoreSelection(u),e=a.encodeHtml(e),i=e.length+n,r.maxLength>0&&i>r.maxLength&&(e=e.substring(0,r.maxLength-n)),r.mode!==o.inlineMode&&(e=e.replace(/\n/g,"<br>")),new o.Html(c,e).setClean(!1).insert(r.beforeInsertHtml,!0),c.clean(),c.placeholders())};if(c.makeUndoable(),void 0!==e)d(e);else if(r.pasteAsText){var u=s.saveSelection();a.pasteHook(this,d)}else setTimeout(function(){c.clean(),c.placeholders()},20);return!0},undo:function(){var e=this.undoable,t=e.stack,n=t.canUndo();return n&&t.undo(),this},redo:function(){var e=this.undoable,t=e.stack,n=t.canRedo();return n&&t.redo(),this}},o.inlineMode="inline",o.partialMode="partial",o.richMode="rich",o.inlineRichMode="inlineRich",o.Messages={pastHere:"Paste Here"},o.defaultSettings={element:null,modifier:"auto",placeholder:"",autofocus:!1,autoHR:!0,mode:o.richMode,maxLength:-1,modifiers:{b:"bold",i:"italicize",u:"underline"},tags:{"break":"br",horizontalRule:"hr",paragraph:"p",outerLevel:["pre","blockquote","figure"],innerLevel:["a","b","u","i","img","strong"]},cssClasses:{editor:"Medium",pasteHook:"Medium-paste-hook",placeholder:"Medium-placeholder",clear:"Medium-clear"},attributes:{remove:["style","class"]},pasteAsText:!0,beforeInvokeElement:function(){},beforeInsertHtml:function(){},maxLengthReached:function(e){},beforeAddTag:function(e,t,n,o){},onBlur:function(){},onFocus:function(){},keyContext:null,drag:!1},function(e,t,o){function r(e){return e.hasOwnProperty("target")&&"false"===e.target.getAttribute("contenteditable")?(a.preventDefaultEvent(e),!1):!0}e.Action=function(e){this.medium=e,this.handledEvents={keydown:null,keyup:null,blur:null,focus:null,paste:null,click:null}},e.Action.prototype={setup:function(){this.handleFocus().handleBlur().handleKeyDown().handleKeyUp().handlePaste().handleClick()},destroy:function(){var e=this.medium.element;a.removeEvent(e,"focus",this.handledEvents.focus).removeEvent(e,"blur",this.handledEvents.blur).removeEvent(e,"keydown",this.handledEvents.keydown).removeEvent(e,"keyup",this.handledEvents.keyup).removeEvent(e,"paste",this.handledEvents.paste).removeEvent(e,"click",this.handledEvents.click)},handleFocus:function(){var n=this.medium,o=n.element;return a.addEvent(o,"focus",this.handledEvents.focus=function(i){return i=i||t.event,r(i)?(e.activeElement=o,n.cache.originalVal=i.target.textContent,n.settings.onFocus(i),void n.placeholders()):!1}),this},handleBlur:function(){var n=this.medium,o=n.element;return a.addEvent(o,"blur",this.handledEvents.blur=function(i){i=i||t.event,e.activeElement===o&&(e.activeElement=null),n.settings.onBlur(i),n.placeholders()}),this},handleKeyDown:function(){var n=this,o=this.medium,s=o.settings,l=o.cache,c=o.element;return a.addEvent(c,"keydown",this.handledEvents.keydown=function(d){if(d=d||t.event,!r(d))return!1;var u=!0;if(229!==d.keyCode){if(a.isCommand(s,d,function(){l.cmd=!0},function(){l.cmd=!1}),a.isShift(d,function(){l.shift=!0},function(){l.shift=!1}),a.isModifier(s,d,function(t){if(l.cmd){if(s.mode===e.inlineMode||s.mode===e.partialMode)return a.preventDefaultEvent(d),!1;var n=typeof t,i=null;return i="function"===n?t:o[t],u=i.call(o,d),(u===!1||u===o)&&(a.preventDefaultEvent(d),a.stopPropagation(d)),!0}return!1}),-1!==s.maxLength){var f=a.text(c).length,h=!1,g=t.getSelection(),m=a.isSpecial(d),p=a.isNavigational(d);if(g&&(h=!g.isCollapsed),m||p)return!0;if(f>=s.maxLength&&!h)return s.maxLengthReached(c),a.preventDefaultEvent(d),!1}switch(d.keyCode){case i.enter:n.enterKey(d)===!1&&a.preventDefaultEvent(d);break;case i.escape:n.escKey(d)===!1&&a.preventDefaultEvent(d);break;case i.backspace:case i["delete"]:n.backspaceOrDeleteKey(d)}return u}}),this},handleKeyUp:function(){var e=this,n=this.medium,o=n.settings,i=n.cache,s=n.cursor,l=n.element;return a.addEvent(l,"keyup",this.handledEvents.keyup=function(l){if(l=l||t.event,!r(l))return!1;a.isCommand(o,l,function(){i.cmd=!1},function(){i.cmd=!0}),n.clean(),n.placeholders();var c;if(null!==o.keyContext&&(c=o.keyContext[l.keyCode])){var d=s.parent();d&&c.call(n,l,d)}e.preserveElementFocus()}),this},handlePaste:function(){var e=this.medium,n=e.element,o,i,s,l,c,d,u;return a.addEvent(n,"paste",this.handledEvents.paste=function(n){if(n=n||t.event,!r(n))return!1;if(i=0,a.preventDefaultEvent(n),o="",c=n.clipboardData,c&&(l=c.getData))for(u=c.types,s=u.length,i=0;s>i;i++)switch(d=u[i]){case"text/plain":return e.paste(c.getData("text/plain"))}e.paste()}),this},handleClick:function(){var e=this.medium,t=e.element,n=e.cursor;return a.addEvent(t,"click",this.handledEvents.click=function(e){r(e)||n.caretToAfter(e.target)}),this},escKey:function(t){var n=this.medium,o=n.element,i=n.settings,r=n.cache;return i.mode===e.inlineMode||i.mode===e.inlineRichMode?(t.target.textContent=r.originalVal,i.element.blur?i.element.blur():i.element.onblur&&i.element.onblur(),!1):void 0},enterKey:function(t){var n=this.medium,o=n.element,i=n.settings,r=n.cache,s=n.cursor;if(i.mode===e.inlineMode||i.mode===e.inlineRichMode)return i.element.blur?i.element.blur():i.element.onblur&&i.element.onblur(),!1;if(r.shift){if(i.tags["break"])return n.addTag(i.tags["break"],!0),!1}else{var l=a.atCaret(n)||{},c=o.children,d=l===o.lastChild?o.lastChild:null,u,f,h;d&&d!==o.firstChild&&i.autoHR&&i.mode!==e.partialMode&&i.tags.horizontalRule&&(a.preventDefaultEvent(t),u=""===a.text(d)&&d.nodeName.toLowerCase()===i.tags.paragraph,u&&c.length>=2&&(f=c[c.length-2],f.nodeName.toLowerCase()===i.tags.horizontalRule&&(u=!1)),u&&(n.addTag(i.tags.horizontalRule,!1,!0,l),l=l.nextSibling),null!==(h=n.addTag(i.tags.paragraph,!0,null,l))&&(h.innerHTML="",s.set(n,0,h)))}return!0},backspaceOrDeleteKey:function(e){var t=this.medium,o=t.cursor,i=t.settings,r=t.element;if(void 0!==i.onBackspaceOrDelete){var s=i.onBackspaceOrDelete.call(t,e,r);if(s)return}if(null!==r.lastChild){var l=r.lastChild,c=l.previousSibling,d=n.getSelection().anchorNode;l&&i.tags.horizontalRule&&l.nodeName.toLocaleLowerCase()===i.tags.horizontalRule?r.removeChild(l):l&&c&&a.text(l).length<1&&c.nodeName.toLowerCase()===i.tags.horizontalRule&&l.nodeName.toLowerCase()===i.tags.paragraph?(r.removeChild(l),r.removeChild(c)):1===r.childNodes.length&&l&&!a.text(l).length?(a.preventDefaultEvent(e),t.setupContents()):d&&d===r&&(t.deleteSelection(),t.setupContents(),o.set(t,0,r.firstChild))}},preserveElementFocus:function(){var e=t.getSelection?t.getSelection().anchorNode:document.activeElement;if(e){var n=this.medium,o=n.cache,i=n.element,r=n.settings,a=e.parentNode,s=i.children,l=a!==o.focusedElement,c=0,d;for(a===r.element&&(a=e),d=0;d<s.length;d++)if(a===s[d]){c=d;break}l&&(o.focusedElement=a,o.focusedElementIndex=c)}}}}(o,e,t),function(e){e.Cache=function(){this.initialized=!1,this.cmd=!1,this.focusedElement=null,this.originalVal=null}}(o),function(o){o.Cursor=function(e){this.medium=e},o.Cursor.prototype={set:function(n,o){var i;if(t.createRange){var r=e.getSelection(),s=this.medium.lastChild(),l=a.text(s).length-1,c=o?o:s,d="undefined"!=typeof n&&null!==n?n:l;i=t.createRange(),i.setStart(c,d),i.collapse(!0),r.removeAllRanges(),r.addRange(i)}else i=t.body.createTextRange(),i.moveToElementText(o),i.collapse(!1),i.select()},moveCursorToEnd:function(e){var t=n.getSelection(),o=n.createRange();o.setStartAfter(e),o.setEnd(e,e.length||e.childNodes.length),t.removeAllRanges(),t.addRange(o)},moveCursorToAfter:function(e){var t=n.getSelection();if(t.rangeCount){var o=t.getRangeAt(0);o.collapse(!1),o.collapseAfter(e),t.setSingleRange(o)}},parent:function(){var n=null,o;return e.getSelection?(o=e.getSelection().getRangeAt(0),n=o.commonAncestorContainer,n=1===n.nodeType?n:n.parentNode):t.selection&&(n=t.selection.createRange().parentElement()),"SPAN"==n.tagName&&(n=n.parentNode),n},caretToBeginning:function(e){this.set(0,e)},caretToEnd:function(e){this.moveCursorToEnd(e)},caretToAfter:function(e){this.moveCursorToAfter(e)}}}(o),function(n){n.Drag=function(e){this.medium=e;var n=this,o=this.iconSrc.replace(/[{][{]([a-zA-Z]+)[}][}]/g,function(e,t){return n.hasOwnProperty(t)?n[t]:e}),i=this.icon=t.createElement("img");i.className=this.buttonClass,i.setAttribute("contenteditable","false"),i.setAttribute("src",o),this.hide(),this.element=null,this.protectedElement=null,this.handledEvents={dragstart:null,dragend:null,mouseover:null,mouseout:null,mousemove:null}},n.Drag.prototype={elementClass:"Medium-focused",buttonClass:"Medium-drag",iconSrc:'data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="21.424px" height="21.424px" viewBox="0 0 21.424 21.424" style="enable-background:new 0 0 21.424 21.424;" xml:space="preserve">	<g>		<g>			<path style="fill:{{iconColor}};" d="M13.616,17.709L13.616,17.709h0.781l-3.686,3.715l-3.685-3.715h0.781l0,0H13.616z M13.616,17.709 M14.007,17.709 M12.555,19.566 M8.87,19.566 M7.418,17.709 M7.809,17.709 M10.712,17.709"/>			<path style="fill:{{iconColor}};" d="M13.616,3.715L13.616,3.715h0.781L10.712,0L7.027,3.715h0.781l0,0H13.616z M13.616,3.715 M14.007,3.715 M12.555,1.858 M8.87,1.858 M7.418,3.715 M7.809,3.715 M10.712,3.715"/>			<path style="fill:{{iconColor}};" d="M3.716,13.616L3.716,13.616v0.781L0,10.712l3.716-3.685v0.781l0,0V13.616z M3.716,13.616 M3.716,14.007 M1.858,12.555 M1.858,8.87 M3.716,7.417 M3.716,7.808 M3.716,10.712"/>			<path style="fill:{{iconColor}};" d="M17.709,13.616L17.709,13.616v0.781l3.715-3.685l-3.715-3.685v0.781l0,0V13.616z M17.709,13.616 M17.709,14.007 M19.566,12.555 M19.566,8.87 M17.709,7.417 M17.709,7.808 M17.709,10.712"/>		</g>		<path style="fill-rule:evenodd;clip-rule:evenodd;fill:{{iconColor}};" d="M10.712,6.608c2.267,0,4.104,1.838,4.104,4.104 c0,2.266-1.837,4.104-4.104,4.104c-2.266,0-4.104-1.837-4.104-4.104C6.608,8.446,8.446,6.608,10.712,6.608L10.712,6.608z M10.712,7.515c-1.765,0-3.196,1.432-3.196,3.197s1.432,3.197,3.196,3.197c1.766,0,3.197-1.432,3.197-3.197 S12.478,7.515,10.712,7.515z"/>	</g></svg>',iconColor:"#231F20",setup:function(){this.handleDragstart().handleDragend().handleMouseover().handleMouseout().handleMousemove()},destroy:function(){a.removeEvent(this.icon,"dragstart",this.handledEvents.dragstart).removeEvent(this.icon,"dragend",this.handledEvents.dragend).removeEvent(this.icon,"mouseover",this.handledEvents.mouseover).removeEvent(this.icon,"mouseout",this.handledEvents.mouseout).removeEvent(this.medium.element,"mousemove",this.handledEvents.mousemove)},hide:function(){a.hide(this.icon)},handleDragstart:function(){var t=this;return a.addEvent(this.icon,"dragstart",this.handledEvents.dragstart=function(n){null===t.protectedElement&&(n=n||e.event,t.protectedElement=a.detachNode(t.element),t.icon.style.opacity=0)}),this},handleDragend:function(){var e=this;return a.addEvent(this.icon,"dragend",this.handledEvents.dragend=t.body.ondragend=function(t){null!==e.protectedElement&&setTimeout(function(){e.cleanCanvas(),e.protectedElement=null},1)}),this},handleMouseover:function(){var e=this;return a.addEvent(this.icon,"mouseover",this.handledEvents.mouseover=function(t){null===e.protectedElement&&a.stopPropagation(t).addClass(e.element,e.elementClass)}),this},handleMouseout:function(){var e=this;return a.addEvent(this.icon,"mouseout",this.handledEvents.mouseout=function(t){null===e.protectedElement&&a.stopPropagation(t).removeClass(e.element,e.elementClass)}),this},handleMousemove:function(){var t=this;return a.addEvent(this.medium.element,"mousemove",this.handledEvents.mousemove=function(n){n=n||e.event;var o=n.target||{};"false"===o.getAttribute("contenteditable")&&t.show(o)}),this},show:function(e){if(e!==this.icon||null!==this.protectedElement){this.element=e;var t=this.icon.style,n=e.offsetLeft,o=e.offsetTop;e.dragIcon=this.icon,e.parentNode.appendChild(this.icon),t.opacity=1,t.left=n+"px",t.top=o+"px",a.show(this.icon)}},cleanCanvas:function(){var e,n=!1,o=t.getElementsByClassName(this.buttonClass);for(this.icon.style.opacity=1;o.length>0;)a.isVisible(e=o[0])&&(n||(e.parentNode.insertBefore(this.element,e),n=!0),a.detachNode(e));a.detachNode(this.icon)}}}(o),function(t){t.Element=function(e,t,n){switch(this.medium=e,this.element=e.element,t.toLowerCase()){case"bold":this.tagName="b";break;case"italic":this.tagName="i";break;case"underline":this.tagName="u";break;default:this.tagName=t}this.attributes=n||{},this.clean=!0},t.Element.prototype={invoke:function(o){if(t.activeElement===this.element){o&&o.apply(this);var i=this.attributes,r=this.tagName.toLowerCase(),a,s;void 0!==i.className?(s=(i.className.split[" "]||[i.className]).shift(),delete i.className):s="medium-"+r,a=n.createClassApplier(s,{elementTagName:r,elementAttributes:this.attributes}),this.medium.makeUndoable(),a.toggleSelection(e),this.clean&&(this.medium.clean(),this.medium.placeholders())}},setClean:function(e){return this.clean=e,this}}}(o),function(e){e.Html=function(t,n){this.html=n,this.medium=t,this.clean=!0,this.injector=new e.Injector},e.Html.prototype={insert:function(t,n){if(e.activeElement===this.medium.element){t&&t.apply(this);var o=this.injector.inject(this.html,n);return this.clean&&(this.medium.clean(),this.medium.placeholders()),this.medium.makeUndoable(),o}return null},setClean:function(e){return this.clean=e,this}}}(o),function(n){n.Injector=function(){},n.Injector.prototype={inject:function(e){var n=[],o,i=!1;if("string"==typeof e){var r=t.createElement("div");r.innerHTML=e,o=r.childNodes,i=!0}else o=e;this.insertHTML('<span id="Medium-wedge"></span>');var a=t.getElementById("Medium-wedge"),s=a.parentNode,l=0;if(a.removeAttribute("id"),i){for(;l<o.length;)n.push(o[l]),l++;for(;o.length>0;)s.insertBefore(o[0],a)}else n.push(o),s.insertBefore(o,a);return s.removeChild(a),a=null,n},insertHTML:function(n,o){var i,r;if(e.getSelection){if(i=e.getSelection(),i.getRangeAt&&i.rangeCount){r=i.getRangeAt(0),r.deleteContents();var a=t.createElement("div");a.innerHTML=n;for(var s=t.createDocumentFragment(),l,c;l=a.firstChild;)c=s.appendChild(l);var d=s.firstChild;r.insertNode(s),c&&(r=r.cloneRange(),r.setStartAfter(c),o?r.setStartBefore(d):r.collapse(!0),i.removeAllRanges(),i.addRange(r))}}else if((i=t.selection)&&"Control"!=i.type){var u=i.createRange();u.collapse(!0),i.createRange().pasteHTML(n),o&&(r=i.createRange(),r.setEndPoint("StartToStart",u),r.select())}}}}(o),function(n){n.Selection=function(){},n.Selection.prototype={saveSelection:function(){if(e.getSelection){var n=e.getSelection();if(n.rangeCount>0)return n.getRangeAt(0)}else if(t.selection&&t.selection.createRange)return t.selection.createRange();return null},restoreSelection:function(n){if(n)if(e.getSelection){var o=e.getSelection();o.removeAllRanges(),o.addRange(n)}else t.selection&&n.select&&n.select()}}}(o),function(n){n.Toolbar=function(e,n){this.medium=e;var o=t.createElement("div");o.innerHTML=this.html,this.buttons=n,this.element=o.children[0],t.body.appendChild(this.element),this.active=!1,this.busy=!0,this.handledEvents={scroll:null,mouseup:null,keyup:null}},n.Toolbar.prototype={fixedClass:"Medium-toolbar-fixed",showClass:"Medium-toolbar-show",hideClass:"Medium-toolbar-hide",html:'<div class="Medium-toolbar">				<div class="Medium-tail-outer">					<div class="Medium-tail-inner"></div>				</div>				<div id="Medium-buttons"></div>				<table id="Medium-options">					<tbody>						<tr>						</tr>					</tbody>				</table>			</div>',setup:function(){this.handleScroll().handleMouseup().handleKeyup()},destroy:function(){a.removeEvent(e,"scroll",this.handledEvents.scroll).removeEvent(t,"mouseup",this.handledEvents.mouseup).removeEvent(t,"keyup",this.handledEvents.keyup)},handleScroll:function(){var t=this;return a.addEvent(e,"scroll",this.handledEvents.scroll=function(){t.active&&t.goToSelection()}),this},handleMouseup:function(){var e=this;return a.addEvent(t,"mouseup",this.handledEvents.mouseup=function(){n.activeElement!==e.medium.element||e.busy||e.goToSelection()}),this},handleKeyup:function(){var e=this;return a.addEvent(t,"keyup",this.handledEvents.keyup=function(){n.activeElement!==e.medium.element||e.busy||e.goToSelection()}),this},goToSelection:function(){var t=this.getHighlighted(),n=t.boundary.top-5,o=this.element,i=o.style;e.scrollTop>0?a.addClass(o,this.fixedClass):a.removeClass(o,this.fixedClass),null!==t&&(t.range.startOffset!==t.range.endOffset||t.text?(a.removeClass(o,this.hideClass).removeClass(o,this.showClass),i.opacity=.01,a.addClass(o,this.showClass),i.opacity=1,i.top=n-65+"px",i.left=t.boundary.left+t.boundary.width/2-o.clientWidth/2+"px",this.active=!0):(a.removeClass(o,this.showClass).addClass(o,this.hideClass),this.active=!1))},getHighlighted:function(){var t=e.getSelection(),n=t.anchorNode?t.getRangeAt(0):!1;return n?{selection:t,range:n,text:a.trim(n.toString()),boundary:n.getBoundingClientRect()}:null}}}(o),function(e){e.Undoable=function(e){var t=this,n=e.settings.element,o,r,s=new Undo.Stack,l=Undo.Command.extend({constructor:function(e,t){this.oldValue=e,this.newValue=t},execute:function(){},undo:function(){n.innerHTML=this.oldValue,e.canUndo=s.canUndo(),e.canRedo=s.canRedo(),e.dirty=s.dirty()},redo:function(){n.innerHTML=this.newValue,e.canUndo=s.canUndo(),e.canRedo=s.canRedo(),e.dirty=s.dirty()}}),c=function(o){var i=n.innerHTML;o?(r=n.innerHTML,s.execute(new l(r,r))):i!=r&&(t.movingThroughStack||(s.execute(new l(r,i)),r=i,e.dirty=s.dirty()),a.triggerEvent(e.settings.element,"change"))};this.medium=e,this.timer=o,this.stack=s,this.makeUndoable=c,this.EditCommand=l,this.movingThroughStack=!1,a.addEvent(n,"keyup",function(e){return e.ctrlKey||e.keyCode===i.z?void a.preventDefaultEvent(e):(clearTimeout(o),void(o=setTimeout(function(){c()},250)))}).addEvent(n,"keydown",function(e){return e.ctrlKey&&e.keyCode===i.z?(a.preventDefaultEvent(e),t.movingThroughStack=!0,void(e.shiftKey?s.canRedo()&&s.redo():s.canUndo()&&s.undo())):void(t.movingThroughStack=!1)})}}(o),function(n){n.Utilities={isCommand:function(e,t,n,o){return"ctrl"===e.modifier&&t.ctrlKey||"cmd"===e.modifier&&t.metaKey||"auto"===e.modifier&&(t.ctrlKey||t.metaKey)?n.call():o.call()},isShift:function(e,t,n){return e.shiftKey?t.call():n.call()},isModifier:function(e,t,n){var o=e.modifiers[t.keyCode];return o?n.call(null,o):!1},special:function(){var e={};return e[i.backspace]=!0,e[i.shift]=!0,e[i.ctrl]=!0,e[i.alt]=!0,e[i["delete"]]=!0,e[i.cmd]=!0,e}(),isSpecial:function(e){return"undefined"!=typeof n.Utilities.special[e.keyCode]},navigational:function(){var e={};return e[i.upArrow]=!0,e[i.downArrow]=!0,e[i.leftArrow]=!0,e[i.rightArrow]=!0,e}(),isNavigational:function(e){return"undefined"!=typeof n.Utilities.navigational[e.keyCode]},addEvents:function(e,t,o){for(var i=0,r,a=t.split(" "),s=a.length,l=n.Utilities;s>i;i++)r=a[i],r.length>0&&l.addEvent(e,r,o);return n.Utilities},addEvent:function o(e,t,i){return e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i,n.Utilities},removeEvent:function r(e,t,o){return e.removeEventListener?e.removeEventListener(t,o,!1):e.detachEvent?e.detachEvent("on"+t,o):e["on"+t]=null,n.Utilities},preventDefaultEvent:function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,n.Utilities},stopPropagation:function(e){return e=e||window.event,e.cancelBubble=!0,void 0!==e.stopPropagation&&e.stopPropagation(),n.Utilities},isEventSupported:function(e,n){n="on"+n;var o=t.createElement(e.tagName),i=n in o;return i||(o.setAttribute(n,"return;"),i="function"==typeof o[n]),o=null,i},triggerEvent:function(e,o){var i;return t.createEvent?(i=t.createEvent("HTMLEvents"),i.initEvent(o,!0,!0),i.eventName=o,e.dispatchEvent(i)):(i=t.createEventObject(),e.fireEvent("on"+o,i)),n.Utilities},deepExtend:function(e,t){var o,i;for(o in t)t.hasOwnProperty(o)&&(i=t[o],void 0!==i&&null!==i&&void 0!==i.constructor&&i.constructor===Object?(e[o]=e[o]||{},n.Utilities.deepExtend(e[o],i)):e[o]=i);return e},pasteHook:function(e,o){e.makeUndoable();var i=t.createElement("div"),r=e.element,s,l,c,d=e.settings,u,f=t.body,h=f.parentNode,g=h.scrollTop,m=h.scrollLeft;return i.className=d.cssClasses.pasteHook,i.setAttribute("contenteditable",!0),f.appendChild(i),a.selectNode(i),h.scrollTop=g,h.scrollLeft=m,setTimeout(function(){u=a.text(i),r.focus(),d.maxLength>0&&(s=a.text(r),l=s.length,c=l+u.length,c>l&&(u=u.substring(0,d.maxLength-l))),a.detachNode(i),h.scrollTop=g,h.scrollLeft=m,o(u)},0),n.Utilities},traverseAll:function(e,t,o){var i=e.childNodes,r=i.length,a=0,s;if(o=o||1,t=t||{},r>0)for(;r>a;a++){switch(s=i[a],s.nodeType){case 1:n.Utilities.traverseAll(s,t,o+1),void 0!==t.element&&t.element(s,a,o,e);break;case 3:void 0!==t.fragment&&t.fragment(s,a,o,e)}r=i.length,s===e.lastChild&&(a=r)}return n.Utilities},trim:function(e){return e.replace(/^[\s]+|\s+$/g,"")},arrayContains:function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},addClass:function(e,t){return e.classList?e.classList.add(t):e.className+=" "+t,n.Utilities},removeClass:function(e,t){return e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," "),n.Utilities},hasClass:function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},isHidden:function(e){return 0===e.offsetWidth||0===e.offsetHeight},isVisible:function(e){return 0!==e.offsetWidth||0!==e.offsetHeight},encodeHtml:function(e){return t.createElement("a").appendChild(t.createTextNode(e)).parentNode.innerHTML},text:function(e,t){return void 0!==t?null===e?this:(void 0!==e.textContent?e.textContent=t:e.innerText=t,this):null===e?this:void 0!==e.innerText?a.trim(e.innerText):void 0!==e.textContent?a.trim(e.textContent):void 0!==e.data?a.trim(e.data):""},changeTag:function(e,n){var o=t.createElement(n),i,r;for(i=e.firstChild;i;)r=i.nextSibling,o.appendChild(i),i=r;return e.parentNode.insertBefore(o,e),e.parentNode.removeChild(e),o},detachNode:function(e){return null!==e.parentNode&&e.parentNode.removeChild(e),this},selectNode:function(n){var o,i;return n.focus(),t.body.createTextRange?(o=t.body.createTextRange(),o.moveToElementText(n),o.select()):e.getSelection&&(i=e.getSelection(),o=t.createRange(),o.selectNodeContents(n),i.removeAllRanges(),i.addRange(o)),this},baseAtCaret:function(t){if(!t.isActive())return null;var n=e.getSelection?e.getSelection():document.selection;if(n.rangeCount){var o=n.getRangeAt(0),i=o.endContainer;switch(i.nodeType){case 3:if(i.data&&i.data.length!=o.endOffset)return!1}return i}return null},atCaret:function(e){var t=this.baseAtCaret(e)||{},n=e.element;if(t===!1)return null;for(;t&&t.parentNode!==n;)t=t.parentNode;return t&&1==t.nodeType?t:null},hide:function(e){e.style.display="none"},show:function(e){e.style.display=""},hideAnim:function(e){e.style.opacity=1},showAnim:function(e){e.style.opacity=.01,e.style.display=""}}}(o),n.rangePrototype.insertNodeAtEnd=function(e){var t=this.cloneRange();t.collapse(!1),t.insertNode(e),t.detach(),this.setEndAfter(e)},o}(),a=r.Utilities;"function"==typeof define&&define.amd?define(function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:"undefined"!=typeof this&&(this.Medium=r)}.call(this,window,document),remove_facebook_token_in_url(),editable=$("editable");var medium=new Medium({element:editable,placeholder:"",autofocus:!0,autoHR:!0,mode:Medium.richMode,maxLength:-1,modifiers:{b:"bold",i:"italicize",u:"underline",v:"paste"},tags:{"break":"br",horizontalRule:"hr",paragraph:"li",outerLevel:["ol"],innerLevel:["li","b","span","u","i","strong"]},attributes:{remove:["style","class"]}});medium.value(editable.innerHTML),debug&&($("debugger").style.display="block"),sync_mode=window.synchronization||!1,syncStatusMarker=$("sync-status-marker"),sync_mode&&(localstorage_var_name="memotab",
user={},user.id=$("user_id").value,user.email=$("user_email").value,user.memo=decodeHtml($("user_memo").value),user.remoteLastModified=$("user_last_modified").value,user.update_remote_from_local=function(){console.log("update_remote_from_local started."),sync_mode&&hasChanged?(syncStatusMarker.innerHTML="Syncing...",minAjax({url:"/update-memo",type:"POST",data:{id:user.id,email:user.email,memo:appendLI(localStorage.getItem(localstorage_var_name)),last_modified:localStorage.getItem("localLastModified")},success:function(e){localStorage.setItem("remoteLastModified",e),remoteLastModifiedMarker.innerHTML=e,user.remoteLastModified=e,hasChanged=!1,syncStatusMarker.innerHTML="Saved online.",console.log("update_remote_from_local finished.")}})):(console.log("update_remote_from_local condition is false."),console.log("sync_mode: "+sync_mode),console.log("hasChanged: "+hasChanged))},user.update_local_from_remote=function(e){var t=document.querySelector("#sync-status-marker");clearInterval(timerInt),console.log("update_local_from_remote started.");var n=e,o,i;timerInt=setInterval(function(){o=parseInt(n/60,10),i=parseInt(n%60,10),o=10>o?"0"+o:o,i=10>i?"0"+i:i,t.textContent="",e-5>n&&(t.textContent=""),e-15>n&&(t.textContent="Syncing in "+o+":"+i),--n<0&&(n=e,minAjax({url:"/fetch-memo",type:"POST",data:{id:user.id,email:user.email},success:function(e){localStorage.setItem(localstorage_var_name,e),$("editable").innerHTML=e,t.textContent="All synced.",console.log("update_local_from_remote finished.")}}))},1e3)},localStorage.setItem("remoteLastModified",user.remoteLastModified),remoteLastModified=new Date(localStorage.remoteLastModified),localLastModified=new Date(localStorage.localLastModified),localStorage.setItem(localstorage_var_name,user.memo),remoteLastModified.getTime()>localLastModified.getTime()&&localStorage.setItem(localstorage_var_name,user.memo),remoteLastModifiedMarker=$("remoteLastModified")),addEvent(editable,"keyup",function(){window.clearTimeout(localKeyUpTimer),localStorage.setItem(localstorage_var_name,this.innerHTML);var e=new Date,t=e.toISOString().substring(0,19).replace("T"," ");localStorage.setItem("localLastModified",t),hasChanged=!0,localKeyUpTimer=setTimeout(function(){syncStatusMarker.innerHTML="Saved locally.",setTimeout(function(){syncStatusMarker.innerHTML=""},3e3)},3e3),sync_mode&&user.update_local_from_remote(20)}),addEvent(editable,"keydown",function(){syncStatusMarker.innerHTML=""}),addEvent($("clear"),"click",function(){medium.value(""),localStorage.setItem(localstorage_var_name,""),editable.focus()}),localStorage.getItem(localstorage_var_name)&&medium.value(localStorage.getItem(localstorage_var_name)),sync_mode&&(setInterval(user.update_remote_from_local,refresh_rate),addEvent(document,"mousemove",function(){user.update_local_from_remote(20)}),addEvent(window,"beforeunload",function(){user.update_remote_from_local()}),user.update_local_from_remote(20));
//# sourceMappingURL=./dnfm-min.js.map